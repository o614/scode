<!DOCTYPE html>
<html lang="zh-CN" class="antialiased">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="theme-color" content="#000000">
  <title>Movie Hub</title>
  
  <script src="https://cdn.tailwindcss.com"></script>
  
  <script src="https://cdn.jsdelivr.net/npm/@phosphor-icons/web"></script>

  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            dark: { bg: '#000000', card: '#1C1C1E', text: '#F5F5F7', sub: '#98989D', border: 'rgba(255,255,255,0.15)', input: 'rgba(255, 255, 255, 0.1)' }
          },
          fontFamily: { sans: ['SF Pro Display', '-apple-system', 'sans-serif'] }
        }
      }
    }
  </script>
  
  <style>
    body { background-color: #000000; color: #F5F5F7; }
    
    /* --- ä¿®å¤æ ¸å¿ƒï¼šåŸç”Ÿ CSS åŠ¨ç”»å®šä¹‰ --- */
    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(20px) scale(0.98); }
      to { opacity: 1; transform: translateY(0) scale(1); }
    }

    @keyframes shake {
      10%, 90% { transform: translate3d(-1px, 0, 0); }
      20%, 80% { transform: translate3d(2px, 0, 0); }
      30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
      40%, 60% { transform: translate3d(4px, 0, 0); }
    }

    /* é»˜è®¤éšè—é¡µé¢ */
    .page { display: none; }
    
    /* æ¿€æ´»åæ‰§è¡ŒåŸç”ŸåŠ¨ç”» */
    .page.active { 
      display: block; 
      animation: fadeInUp 0.5s cubic-bezier(0.16, 1, 0.3, 1) forwards; 
    }

    .progress-ring__circle { transition: stroke-dashoffset 1s linear; transform: rotate(-90deg); transform-origin: 50% 50%; }
    
    /* è¾…åŠ©ç±» */
    .active-scale:active { transform: scale(0.96); transition: transform 0.1s; }
    .animate-shake { animation: shake 0.82s cubic-bezier(.36,.07,.19,.97) both infinite; }
  </style>
</head>

<body class="font-sans min-h-screen flex flex-col pb-safe relative overflow-x-hidden">

  <nav class="sticky top-0 z-40 bg-[#1C1C1E]/80 backdrop-blur-xl border-b border-dark-border px-6 py-4 pt-[max(1rem,env(safe-area-inset-top))] flex justify-between items-center">
    <div class="flex items-center gap-2 font-bold text-lg tracking-tight cursor-pointer" onclick="showPage('home')">
      <i class="ph-fill ph-film-strip text-purple-500 text-xl"></i>
      <span>Movie Hub</span>
    </div>
    <div id="lockStatus" class="text-xs font-medium bg-white/10 px-3 py-1 rounded-full text-dark-sub flex items-center gap-1">
      <i class="ph-fill ph-lock-key"></i> æœªè§£é”
    </div>
  </nav>

  <main id="page-home" class="page active flex-1 max-w-2xl mx-auto w-full px-6 py-12">
    <div class="text-center mb-12 mt-10">
      <h1 class="text-4xl md:text-5xl font-bold tracking-tight mb-4">å…¨ç½‘å½±è§†èšåˆ</h1>
      <p class="text-dark-sub">èšåˆ é˜¿é‡Œäº‘ç›˜ã€å¤¸å…‹ã€ç™¾åº¦ç½‘ç›˜ ä¼˜è´¨èµ„æº</p>
    </div>

    <div class="relative group max-w-lg mx-auto">
      <div class="absolute inset-0 bg-purple-600/20 blur-xl rounded-full opacity-0 group-hover:opacity-100 transition-opacity"></div>
      <div class="relative flex items-center">
        <i class="ph-bold ph-magnifying-glass absolute left-5 text-dark-sub text-xl"></i>
        <input type="text" id="searchInput" 
          class="w-full bg-dark-input text-lg py-5 pl-14 pr-32 rounded-full outline-none focus:ring-2 focus:ring-purple-500/50 transition-all placeholder-white/30 text-white border border-white/10"
          placeholder="æœç´¢ç”µå½±ã€å‰§é›†..." 
          onkeypress="if(event.keyCode===13) doSearch()">
        
        <button onclick="doSearch()" class="absolute right-2 bg-white text-black font-bold px-6 py-3 rounded-full hover:bg-gray-200 active:scale-95 transition-all">
          æœç´¢
        </button>
      </div>
    </div>

    <div class="mt-16">
      <h3 class="text-sm font-bold text-dark-sub uppercase tracking-wider mb-4">çƒ­é—¨æœç´¢</h3>
      <div class="flex flex-wrap gap-3">
        <span onclick="quickSearch('å¥¥æœ¬æµ·é»˜')" class="px-4 py-2 bg-dark-card border border-dark-border rounded-lg text-sm hover:bg-white/10 cursor-pointer transition-colors">ğŸ”¥ å¥¥æœ¬æµ·é»˜</span>
        <span onclick="quickSearch('å‘¨å¤„é™¤ä¸‰å®³')" class="px-4 py-2 bg-dark-card border border-dark-border rounded-lg text-sm hover:bg-white/10 cursor-pointer transition-colors">å‘¨å¤„é™¤ä¸‰å®³</span>
        <span onclick="quickSearch('ç¹èŠ±')" class="px-4 py-2 bg-dark-card border border-dark-border rounded-lg text-sm hover:bg-white/10 cursor-pointer transition-colors">ç¹èŠ±</span>
        <span onclick="quickSearch('æ²™ä¸˜2')" class="px-4 py-2 bg-dark-card border border-dark-border rounded-lg text-sm hover:bg-white/10 cursor-pointer transition-colors">æ²™ä¸˜2</span>
      </div>
    </div>
  </main>

  <main id="page-results" class="page flex-1 max-w-3xl mx-auto w-full px-4 py-8">
    <div class="flex items-center gap-2 mb-6 text-dark-sub cursor-pointer hover:text-white" onclick="showPage('home')">
      <i class="ph-bold ph-caret-left"></i> è¿”å›é¦–é¡µ
    </div>
    
    <h2 class="text-2xl font-bold mb-6 flex items-center gap-2">
      æœç´¢ç»“æœ: <span id="searchKeyword" class="text-purple-400">...</span>
    </h2>

    <div id="resultsList" class="space-y-4">
      </div>
  </main>

  <div id="lockModal" class="fixed inset-0 z-50 bg-black/80 backdrop-blur-md flex items-center justify-center p-4 hidden opacity-0 transition-opacity duration-300">
    <div class="bg-[#1C1C1E] w-full max-w-[400px] rounded-[32px] border border-white/10 overflow-hidden shadow-2xl transform scale-95 transition-transform duration-300" id="lockCard">
      
      <div id="step-verify" class="p-8 flex flex-col items-center">
        <div class="relative w-16 h-16 mb-4 flex items-center justify-center">
          <svg class="w-16 h-16 absolute top-0 left-0"><circle class="text-white/10" stroke-width="4" stroke="currentColor" fill="transparent" r="30" cx="32" cy="32"/><circle id="progress-ring" class="text-purple-500 progress-ring__circle" stroke-width="4" stroke-linecap="round" stroke="currentColor" fill="transparent" r="30" cx="32" cy="32"/></svg>
          <i id="status-icon" class="ph-fill ph-lock-key text-2xl text-purple-500 transition-colors"></i>
        </div>

        <h3 class="text-xl font-bold text-white mb-2">è·å–è®¿é—®å¯†ç </h3>
        <p class="text-dark-sub text-sm text-center mb-6 px-4">
          ä¸ºäº†é˜²æ­¢èµ„æºæ»¥ç”¨ï¼Œè¯·æ‰«ç å…³æ³¨å…¬ä¼—å·<br>å‘é€ä¸‹æ–¹æ•°å­—ï¼Œå³å¯è·å–çœŸå®é“¾æ¥ã€‚
        </p>

        <div class="w-32 h-32 bg-white p-1 rounded-xl mb-6">
          <img src="https://www.haiyan.gov.cn/picture/-1/240308141912543626.png" class="w-full h-full object-cover rounded-lg">
        </div>

        <div id="code-box" class="w-full bg-black/30 border border-white/10 rounded-xl py-4 mb-4 text-center relative overflow-hidden">
          <div id="timer-text" class="absolute top-2 right-3 text-[10px] font-bold text-gray-500">60s</div>
          <div id="code-display" class="text-4xl font-mono font-bold tracking-widest text-white">----</div>
          <div id="urgent-bg" class="absolute inset-0 bg-red-500/20 opacity-0 transition-opacity"></div>
        </div>

        <div class="text-xs text-purple-400 flex items-center gap-2">
          <svg class="animate-spin h-3 w-3" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" fill="none"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
          ç­‰å¾…æ‰‹æœºå‘é€...
        </div>
      </div>

      <div id="step-success" class="absolute inset-0 bg-green-600 flex-col items-center justify-center text-white hidden">
        <i class="ph-fill ph-check-circle text-5xl mb-4"></i>
        <h3 class="text-2xl font-bold">éªŒè¯é€šè¿‡</h3>
        <p class="opacity-80 mt-2 text-sm">æ­£åœ¨æ˜¾ç¤ºèµ„æºé“¾æ¥...</p>
      </div>

      <button onclick="closeModal()" class="absolute top-4 right-4 text-white/30 hover:text-white">
        <i class="ph-bold ph-x text-xl"></i>
      </button>
    </div>
  </div>

  <div id="linkModal" class="fixed inset-0 z-50 bg-black/80 backdrop-blur-md flex items-center justify-center p-4 hidden opacity-0 transition-opacity duration-300">
    <div class="bg-[#1C1C1E] w-full max-w-md rounded-3xl border border-white/10 p-8 shadow-2xl relative transform scale-95 transition-transform duration-300" id="linkCard">
      <div class="text-center mb-6">
        <div class="w-16 h-16 bg-blue-500/20 text-blue-400 rounded-2xl flex items-center justify-center mx-auto mb-4">
          <i class="ph-fill ph-link text-3xl"></i>
        </div>
        <h3 class="text-xl font-bold text-white">èµ„æºè·å–æˆåŠŸ</h3>
        <p class="text-dark-sub text-sm mt-2" id="resourceName">æ–‡ä»¶å...</p>
      </div>

      <div class="bg-black/30 rounded-xl p-4 border border-white/5 flex items-center justify-between gap-3 mb-6">
        <div class="truncate text-purple-400 font-mono text-sm flex-1" id="realLink">https://pan.quark.cn/s/xxxx</div>
        <button onclick="copyLink()" class="bg-white/10 hover:bg-white/20 text-white px-3 py-1.5 rounded-lg text-xs font-bold transition-colors">å¤åˆ¶</button>
      </div>

      <a id="jumpBtn" href="#" target="_blank" class="block w-full bg-white text-black font-bold py-3.5 rounded-xl text-center hover:bg-gray-200 transition-colors">
        ç«‹å³è·³è½¬ä¸‹è½½
      </a>
      
      <button onclick="closeLinkModal()" class="absolute top-4 right-4 text-white/30 hover:text-white"><i class="ph-bold ph-x text-xl"></i></button>
    </div>
  </div>

  <script>
    // --- âš™ï¸ é…ç½® ---
    const CONFIG = {
      apiBase: '/api/web', 
      pollInterval: 3000, 
      timeout: 60,
      urgentTime: 15
    };

    let isUnlocked = false;
    let currentResource = {};

    // --- é¡µé¢é€»è¾‘ ---
    function showPage(pageId) {
      document.querySelectorAll('.page').forEach(el => {
        el.classList.remove('active');
        el.style.opacity = 0; // é‡ç½®é€æ˜åº¦
      });
      const target = document.getElementById('page-' + pageId);
      target.classList.add('active'); // è¿™é‡Œçš„ active ä¼šè§¦å‘ CSS åŠ¨ç”»
    }

    function quickSearch(keyword) {
      document.getElementById('searchInput').value = keyword;
      doSearch();
    }

    function doSearch() {
      const q = document.getElementById('searchInput').value.trim();
      if (!q) return document.getElementById('searchInput').focus();

      document.getElementById('searchKeyword').innerText = q;
      const list = document.getElementById('resultsList');
      list.innerHTML = ''; 

      // å‡æ•°æ®ç”Ÿæˆ
      const mockData = [
        { type: 'aliyun', name: 'é˜¿é‡Œäº‘ç›˜', color: 'text-blue-400', bg: 'bg-blue-500/20', icon: 'ph-cloud', link: 'https://www.aliyundrive.com/s/fake_link_ali' },
        { type: 'quark',  name: 'å¤¸å…‹ç½‘ç›˜', color: 'text-purple-400', bg: 'bg-purple-500/20', icon: 'ph-atom', link: 'https://pan.quark.cn/s/fake_link_quark' },
        { type: 'baidu',  name: 'ç™¾åº¦ç½‘ç›˜', color: 'text-red-400', bg: 'bg-red-500/20', icon: 'ph-hard-drives', link: 'https://pan.baidu.com/s/fake_link_baidu' }
      ];

      mockData.forEach(item => {
        const html = `
          <div onclick="handleResourceClick('${item.link}', '${q} - ${item.name}èµ„æº')" 
               class="bg-dark-card border border-dark-border rounded-2xl p-5 flex items-center justify-between cursor-pointer hover:border-white/30 transition-all active:scale-[0.98]">
            <div class="flex items-center gap-4">
              <div class="w-12 h-12 ${item.bg} ${item.color} rounded-xl flex items-center justify-center text-2xl">
                <i class="ph-fill ${item.icon}"></i>
              </div>
              <div>
                <h3 class="font-bold text-lg text-white">${q} (4Kä¿®å¤ç‰ˆ)</h3>
                <div class="flex items-center gap-2 text-xs text-dark-sub mt-1">
                  <span class="bg-white/10 px-2 py-0.5 rounded text-white/80">${item.name}</span>
                  <span>2å°æ—¶å‰æ›´æ–°</span>
                  <span>â€¢ 12.5GB</span>
                </div>
              </div>
            </div>
            <div class="w-8 h-8 rounded-full bg-white/5 flex items-center justify-center text-dark-sub">
              <i class="ph-bold ph-download-simple"></i>
            </div>
          </div>
        `;
        list.insertAdjacentHTML('beforeend', html);
      });

      showPage('results');
    }

    // --- èµ„æºç‚¹å‡» ---
    function handleResourceClick(link, title) {
      currentResource = { link, title };
      
      if (checkCachedToken()) {
        showLinkModal();
      } else {
        openModal();
      }
    }

    // --- éªŒè¯å¼¹çª— ---
    let timerInterval, pollInterval;

    function openModal() {
      const modal = document.getElementById('lockModal');
      const card = document.getElementById('lockCard');
      modal.classList.remove('hidden');
      setTimeout(() => {
        modal.classList.remove('opacity-0');
        card.classList.remove('scale-95');
        card.classList.add('scale-100');
      }, 10);
      startAuthFlow();
    }

    function closeModal() {
      const modal = document.getElementById('lockModal');
      const card = document.getElementById('lockCard');
      modal.classList.add('opacity-0');
      card.classList.add('scale-95');
      setTimeout(() => {
        modal.classList.add('hidden');
        resetModalUI();
      }, 300);
      clearInterval(timerInterval);
      clearInterval(pollInterval);
    }

    function resetModalUI() {
      document.getElementById('step-verify').classList.remove('hidden');
      document.getElementById('step-success').classList.add('hidden');
    }

    // --- æ ¸å¿ƒéªŒè¯ ---
    function startAuthFlow() {
      const code = Math.floor(1000 + Math.random() * 9000);
      document.getElementById('code-display').innerText = code;
      
      let timeLeft = CONFIG.timeout;
      
      fetch(`${CONFIG.apiBase}?type=init&code=${code}`).catch(console.error);

      const circle = document.getElementById('progress-ring');
      const circumference = circle.r.baseVal.value * 2 * Math.PI;
      circle.style.strokeDasharray = `${circumference} ${circumference}`;
      
      timerInterval = setInterval(() => {
        timeLeft--;
        const offset = circumference - (timeLeft / CONFIG.timeout) * circumference;
        circle.style.strokeDashoffset = offset;
        document.getElementById('timer-text').innerText = timeLeft + 's';
        
        if (timeLeft <= CONFIG.urgentTime) {
           document.getElementById('code-display').classList.add('text-red-500', 'animate-shake');
           document.getElementById('status-icon').classList.replace('text-purple-500', 'text-red-500');
           document.getElementById('progress-ring').classList.replace('text-purple-500', 'text-red-500');
        }
        if (timeLeft <= 0) {
           clearInterval(timerInterval);
           alert('éªŒè¯ç å·²è¿‡æœŸï¼Œè¯·é‡æ–°æ‰“å¼€å¼¹çª—');
           closeModal();
        }
      }, 1000);

      pollInterval = setInterval(async () => {
        try {
          const res = await fetch(`${CONFIG.apiBase}?type=check&code=${code}`);
          const json = await res.json();
          if (json.status === 'success') {
            handleSuccess(json.token);
          }
        } catch(e) {}
      }, CONFIG.pollInterval);
    }

    function handleSuccess(token) {
      clearInterval(timerInterval);
      clearInterval(pollInterval);
      
      localStorage.setItem('access_token', token);
      localStorage.setItem('token_time', Date.now());
      
      document.getElementById('step-verify').classList.add('hidden');
      document.getElementById('step-success').classList.remove('hidden');
      document.getElementById('step-success').classList.add('flex');
      
      isUnlocked = true;
      updateLockStatus();

      setTimeout(() => {
        closeModal();
        showLinkModal();
      }, 1500);
    }

    // --- é“¾æ¥å¼¹çª— ---
    function showLinkModal() {
      const modal = document.getElementById('linkModal');
      const card = document.getElementById('linkCard');
      document.getElementById('resourceName').innerText = currentResource.title;
      document.getElementById('realLink').innerText = currentResource.link;
      document.getElementById('jumpBtn').href = currentResource.link;

      modal.classList.remove('hidden');
      setTimeout(() => {
        modal.classList.remove('opacity-0');
        card.classList.remove('scale-95');
        card.classList.add('scale-100');
      }, 10);
    }

    function closeLinkModal() {
      const modal = document.getElementById('linkModal');
      modal.classList.add('opacity-0');
      setTimeout(() => modal.classList.add('hidden'), 300);
    }

    function copyLink() {
      navigator.clipboard.writeText(currentResource.link);
      alert('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
    }

    function checkCachedToken() {
      const token = localStorage.getItem('access_token');
      const time = localStorage.getItem('token_time');
      if (token && time && (Date.now() - time < 604800000)) { 
        isUnlocked = true;
        updateLockStatus();
        return true;
      }
      return false;
    }

    function updateLockStatus() {
      const el = document.getElementById('lockStatus');
      el.className = "text-xs font-medium bg-green-500/20 text-green-400 px-3 py-1 rounded-full flex items-center gap-1";
      el.innerHTML = '<i class="ph-fill ph-check-circle"></i> å·²è§£é”';
    }

    checkCachedToken();
  </script>
</body>
</html>
